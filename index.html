<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Busultan Trading</title>

<style>

/* ---------------------------- */
/*          GLOBAL THEME        */
/* ---------------------------- */

:root {
    --bg-main: #050914;
    --bg-card: rgba(15, 20, 40, 0.8);
    --text-main: #e8ecff;
    --accent: #22c55e;
    --accent2: #0ea5e9;
}

body.theme-light {
    --bg-main: #f0f4ff;
    --bg-card: rgba(255,255,255,0.85);
    --text-main: #0f172a;
    --accent: #16a34a;
    --accent2: #0284c7;
}

/* Background */
body {
    background: var(--bg-main) url("busultan-bg.jpg") center/cover fixed;
    color: var(--text-main);
    font-family: "Segoe UI", sans-serif;
    margin: 0;
    padding: 0;
}

/* Center wrapper */
#app {
    max-width: 1100px;
    margin: 40px auto;
    padding: 20px;
}

/* ---------------------------- */
/*          HEADER TOP          */
/* ---------------------------- */

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
}
<button id="langToggle" class="pill">AR</button>
<div class="logo">
<svg width="70" height="70" viewBox="0 0 200 200">
    
    <!-- Glow Circle -->
    <defs>
        <radialGradient id="cyberGlow" cx="50%" cy="50%" r="50%">
            <stop offset="0%" stop-color="#00eaff" stop-opacity="0.9"/>
            <stop offset="100%" stop-color="#0a0f1f" stop-opacity="0"/>
        </radialGradient>

        <linearGradient id="bullCandle" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#00f5ff"/>
            <stop offset="100%" stop-color="#00b3c6"/>
        </linearGradient>

        <linearGradient id="bearCandle" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#c770ff"/>
            <stop offset="100%" stop-color="#9236ff"/>
        </linearGradient>

        <linearGradient id="trendLine" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="#00eaff"/>
            <stop offset="100%" stop-color="#00a7ff"/>
        </linearGradient>
    </defs>

    <!-- Outer Glow -->
    <circle cx="100" cy="100" r="90" fill="url(#cyberGlow)"/>

    <!-- Thin Circle -->
    <circle cx="100" cy="100" r="80"
            stroke="#00eaff" stroke-width="2"
            fill="transparent" opacity="0.5"/>

    <!-- Trendline -->
    <polyline points="40,130 70,110 110,140 150,80"
              fill="none" stroke="url(#trendLine)" stroke-width="6"
              stroke-linecap="round"/>

    <!-- Bull Candle (Buy) -->
    <rect x="55" y="85" width="18" height="45" rx="4" fill="url(#bullCandle)"/>
    <rect x="63" y="70" width="2" height="15" fill="#00eaff"/>

    <!-- Bear Candle (Sell) -->
    <rect x="120" y="95" width="18" height="35" rx="4" fill="url(#bearCandle)"/>
    <rect x="128" y="130" width="2" height="15" fill="#c770ff"/>

</svg>
<span class="logoText">BUSULTAN</span>
</div>


/* Controls */
.controls {
    display: flex;
    gap: 8px;
}
.pill {
    padding: 8px 14px;
    border-radius: 999px;
    background: rgba(255,255,255,0.08);
    cursor: pointer;
    font-size: 13px;
}

/* ---------------------------- */
/*           MENU TABS          */
/* ---------------------------- */

.nav {
    display: flex;
    gap: 14px;
    margin-bottom: 25px;
}
.nav-btn {
    padding: 10px 18px;
    border-radius: 999px;
    background: rgba(255,255,255,0.08);
    cursor: pointer;
    font-size: 14px;
}
.nav-btn.active {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
}

/* ---------------------------- */
/*        PAGE CONTAINERS       */
/* ---------------------------- */

.page {
    display: none;
    padding: 20px;
    border-radius: 16px;
    background: var(--bg-card);
    box-shadow: 0 0 20px rgba(0,0,0,0.4);
}
.page.active {
    display: block;
    animation: fadeIn 0.4s ease;
}

@keyframes fadeIn {
    from { opacity:0; transform: translateY(10px);}
    to   { opacity:1; transform: translateY(0);}
}

/* Titles */
.page h2 {
    margin-top: 0;
    font-size: 22px;
}


</style>
  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
}

.logo svg {
    filter: drop-shadow(0 0 12px rgba(0,255,255,0.4));
}

.logoText {
    font-size: 26px;
    font-weight: 700;
    background: linear-gradient(90deg, #00eaff, #b37bff);
    -webkit-background-clip: text;
    color: transparent;
    letter-spacing: 1.5px;
}

  /* ---------------------------- */
/*          BACKTESTING         */
/* ---------------------------- */

.back-container {
    background: var(--bg-card);
    padding: 20px;
    border-radius: 20px;
    margin-top: 15px;
    box-shadow: 0 0 25px rgba(0,0,0,0.35);
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px;
    margin-top: 20px;
}

.stat-box {
    background: rgba(0,0,0,0.25);
    border-radius: 14px;
    padding: 18px;
    border: 1px solid rgba(255,255,255,0.05);
}

.stat-box label {
    font-size: 13px;
    opacity: 0.7;
}

.stat-box span {
    display: block;
    margin-top: 8px;
    font-size: 18px;
    font-weight: 600;
}

.pair-performance {
    margin-top: 14px;
    padding: 12px;
    background: rgba(0,0,0,0.25);
    border-radius: 14px;
}

  /* ---------------------------- */
/*          TRADE LOG           */
/* ---------------------------- */

.log-container {
    background: var(--bg-card);
    padding: 20px;
    border-radius: 20px;
    box-shadow: 0 0 25px rgba(0,0,0,0.35);
}

.log-form {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px 18px;
}

.log-form .full {
    grid-column: 1 / -1;
}

.log-form textarea {
    border-radius: 12px;
    padding: 10px;
    background: rgba(5,10,25,0.6);
    color: var(--text-main);
    border: 1px solid rgba(255,255,255,0.12);
    resize: none;
}

.log-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
    font-size: 14px;
}

.log-table th {
    background: rgba(255,255,255,0.08);
    padding: 10px;
}

.log-table td {
    padding: 10px;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}

.log-table tr.win td { color: #22c55e; }
.log-table tr.loss td { color: #ef4444; }
.log-table tr.be td   { color: #eab308; }

.log-table button {
    background: #ef4444;
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 6px;
    cursor: pointer;
}

  /* ---------------------------- */
/*          RISK ENGINE         */
/* ---------------------------- */

.risk-container {
    background: var(--bg-card);
    padding: 20px;
    border-radius: 20px;
    margin-top: 15px;
    box-shadow: 0 0 25px rgba(0,0,0,0.35);
}

.risk-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 14px 18px;
}

.risk-results {
    margin-top: 25px;
    background: rgba(0,0,0,0.3);
    padding: 18px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.08);
}

/* ---------------------------- */
/*      POSITION CALCULATOR     */
/* ---------------------------- */

.calc-container {
    background: var(--bg-card);
    padding: 20px;
    border-radius: 20px;
    margin-top: 15px;
    box-shadow: 0 0 25px rgba(0,0,0,0.35);
}

.calc-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 14px 18px;
}

.field {
    display: flex;
    flex-direction: column;
    gap: 6px;
}

.field.full {
    grid-column: 1 / -1;
}

.field label {
    font-size: 14px;
    opacity: 0.9;
}

.field input,
.field select {
    padding: 10px 12px;
    font-size: 15px;
    border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(5,10,25,0.6);
    color: var(--text-main);
}

body.theme-light .field input,
body.theme-light .field select {
    background: rgba(255,255,255,0.8);
    color: #0f172a;
    border: 1px solid rgba(0,0,0,0.15);
}

.field input:focus,
.field select:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 2px rgba(34,197,94,0.3);
}

.btn-primary {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border: none;
    color: white;
    padding: 12px 20px;
    border-radius: 12px;
    font-size: 16px;
    cursor: pointer;
    font-weight: 600;
    text-align: center;
    box-shadow: 0 10px 20px rgba(0,0,0,0.45);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 16px 26px rgba(0,0,0,0.55);
}

.results {
    margin-top: 25px;
    background: rgba(15,20,40,0.7);
    padding: 20px;
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.08);
}

.results h3 {
    margin-top: 0;
    margin-bottom: 14px;
    font-size: 20px;
}

.res-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px;
}

.res-item {
    padding: 14px;
    background: rgba(0,0,0,0.25);
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.05);
}

.res-item label {
    display: block;
    font-size: 13px;
    opacity: 0.75;
    margin-bottom: 6px;
}

.res-item span {
    font-size: 17px;
    font-weight: 600;
}

.hidden {
    display: none;
}

</head>
<body class="theme-dark">

<div id="app">

    <!-- Header -->
    

    <!-- Navigation -->
    <div class="nav">
        <div class="nav-btn active" data-page="pos">Position Sizing</div>
        <div class="nav-btn" data-page="risk">Risk Engine</div>
        <div class="nav-btn" data-page="log">Trade Log</div>
        <div class="nav-btn" data-page="back">Backtesting</div>
    </div>

    <!-- Pages -->
    <div id="pos" class="page active">

    <h2>Position Sizing Calculator</h2>

    <div class="calc-container">

        <div class="calc-grid">

            <div class="field">
                <label>Account Balance (USD)</label>
                <input id="balance" type="number" placeholder="مثال: 10000">
            </div>

            <div class="field">
                <label>Risk %</label>
                <input id="risk" type="number" placeholder="1 = 1%">
            </div>

            <div class="field">
                <label>Entry Price</label>
                <input id="entry" type="number" placeholder="1.08500">
            </div>

            <div class="field">
                <label>Stop Loss Price (SL)</label>
                <input id="sl" type="number" placeholder="يتم حسابه تلقائيًا إذا تركته فارغ">
            </div>

            <div class="field">
                <label>Stop Distance (Pips)</label>
                <input id="stopPips" type="number" placeholder="20">
            </div>

            <div class="field">
                <label>Trade Direction</label>
                <select id="direction">
                    <option value="buy">Buy</option>
                    <option value="sell">Sell</option>
                </select>
            </div>

            <div class="field full">
                <label>Symbol</label>
                <select id="symbol">
                    <option value="EURUSD" data-group="major">EURUSD</option>
                    <option value="USDJPY" data-group="jpy">USDJPY</option>
                    <option value="XAUUSD" data-group="metals">XAUUSD (Gold)</option>
                    <option value="WTI" data-group="oil">WTI Oil</option>
                    <option value="US100" data-group="indices">US100 Nasdaq</option>
                    <option value="GBPJPY" data-group="jpy">GBPJPY</option>
                    <option value="AUDCAD" data-group="cross">AUDCAD</option>
                </select>
            </div>

            <div class="field">
                <label>Leverage</label>
                <input id="leverage" type="number" placeholder="500" value="500">
            </div>

            <div class="field full">
                <button id="calcBtn" class="btn-primary">Calculate</button>
            </div>

        </div>

        <div class="results hidden" id="resultsBox">

            <h3>Results</h3>
            <div class="res-grid">

                <div class="res-item">
                    <label>Lot Size</label>
                    <span id="lotSize">0.00</span>
                </div>

                <div class="res-item">
                    <label>Risk Amount ($)</label>
                    <span id="riskAmount">0</span>
                </div>

                <div class="res-item">
                    <label>Pip Distance</label>
                    <span id="pipDistance">0</span>
                </div>

                <div class="res-item">
                    <label>Margin Required</label>
                    <span id="marginRequired">0</span>
                </div>

                <div class="res-item">
                    <label>Notional</label>
                    <span id="notional">0</span>
                </div>

                <div class="res-item">
                    <label>TP1 (2× Risk)</label>
                    <span id="tp1">0</span>
                </div>

                <div class="res-item">
                    <label>TP2 (3× Risk)</label>
                    <span id="tp2">0</span>
                </div>

                <div class="res-item">
                    <label>TP3 (4× Risk)</label>
                    <span id="tp3">0</span>
                </div>

            </div>

        </div>

    </div>

</div>


    <div id="risk" class="page">

    <h2>Risk Engine</h2>

    <div class="risk-container">

        <div class="risk-grid">

            <div class="field">
                <label>Account Balance (USD)</label>
                <input id="r_balance" type="number" placeholder="10000">
            </div>

            <div class="field">
                <label>Risk % per Trade</label>
                <input id="r_riskPct" type="number" placeholder="1">
            </div>

            <div class="field">
                <label>Entry Price</label>
                <input id="r_entry" type="number" placeholder="1.08500">
            </div>

            <div class="field">
                <label>Stop Loss Price (SL)</label>
                <input id="r_sl" type="number" placeholder="تركه فارغ للحساب التلقائي">
            </div>

            <div class="field">
                <label>Stop Distance (Pips)</label>
                <input id="r_stopPips" type="number" placeholder="20">
            </div>

            <div class="field">
                <label>Direction</label>
                <select id="r_direction">
                    <option value="buy">Buy</option>
                    <option value="sell">Sell</option>
                </select>
            </div>

            <div class="field full">
                <label>Symbol</label>
                <select id="r_symbol">
                    <option value="EURUSD" data-group="major">EURUSD</option>
                    <option value="USDJPY" data-group="jpy">USDJPY</option>
                    <option value="XAUUSD" data-group="metals">XAUUSD</option>
                    <option value="WTI" data-group="oil">WTI</option>
                    <option value="US100" data-group="indices">US100</option>
                </select>
            </div>

            <div class="field full">
                <button id="r_calcBtn" class="btn-primary">Calculate Risk Engine</button>
            </div>

        </div>

        <!-- RESULTS -->
        <div id="r_results" class="risk-results hidden">

            <h3>Risk Analysis</h3>
            <div class="res-grid">

                <div class="res-item">
                    <label>Risk Amount ($)</label>
                    <span id="r_riskAmount">0</span>
                </div>

                <div class="res-item">
                    <label>Pip Distance</label>
                    <span id="r_pipDistance">0</span>
                </div>

                <div class="res-item">
                    <label>Lot Size</label>
                    <span id="r_lotSize">0</span>
                </div>

                <div class="res-item">
                    <label>Reward (TP1)</label>
                    <span id="r_reward1">0</span>
                </div>

                <div class="res-item">
                    <label>Reward (TP2)</label>
                    <span id="r_reward2">0</span>
                </div>

                <div class="res-item">
                    <label>Reward (TP3)</label>
                    <span id="r_reward3">0</span>
                </div>

                <div class="res-item">
                    <label>R:R (TP1)</label>
                    <span id="r_rr1">0</span>
                </div>

                <div class="res-item">
                    <label>R:R (TP2)</label>
                    <span id="r_rr2">0</span>
                </div>

                <div class="res-item">
                    <label>R:R (TP3)</label>
                    <span id="r_rr3">0</span>
                </div>

            </div>

        </div>

    </div>

</div>


    <div id="log" class="page">

    <h2>Trade Log</h2>

    <div class="log-container">

        <div class="log-form">

            <div class="field">
                <label>Symbol</label>
                <input id="log_symbol" placeholder="EURUSD">
            </div>

            <div class="field">
                <label>Direction</label>
                <select id="log_direction">
                    <option value="Buy">Buy</option>
                    <option value="Sell">Sell</option>
                </select>
            </div>

            <div class="field">
                <label>Entry Price</label>
                <input id="log_entry" type="number" placeholder="Entry">
            </div>

            <div class="field">
                <label>Stop Loss</label>
                <input id="log_sl" type="number" placeholder="SL">
            </div>

            <div class="field">
                <label>TP1</label>
                <input id="log_tp1" type="number">
            </div>

            <div class="field">
                <label>TP2</label>
                <input id="log_tp2" type="number">
            </div>

            <div class="field">
                <label>TP3</label>
                <input id="log_tp3" type="number">
            </div>

            <div class="field">
                <label>Result</label>
                <select id="log_result">
                    <option value="Win">Win</option>
                    <option value="Loss">Loss</option>
                    <option value="BE">Break Even</option>
                </select>
            </div>

            <div class="field full">
                <label>Notes</label>
                <textarea id="log_notes" placeholder="Reason for entry" rows="3"></textarea>
            </div>

            <div class="field full">
                <button id="log_add" class="btn-primary">Add Trade</button>
            </div>

        </div>

        <h3 style="margin-top:30px;">Saved Trades</h3>

        <div style="margin-bottom:10px;">
            <button id="log_export" class="pill">Export CSV</button>
            <button id="log_clear" class="pill" style="background:#b91c1c;color:white;">Clear All</button>
        </div>

        <table class="log-table" id="log_table">
            <thead>
                <tr>
                    <th>Symbol</th>
                    <th>Dir</th>
                    <th>Entry</th>
                    <th>SL</th>
                    <th>TP1</th>
                    <th>TP2</th>
                    <th>TP3</th>
                    <th>Result</th>
                    <th>Notes</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody id="log_body"></tbody>
        </table>

    </div>

</div>


   <div id="back" class="page">

    <h2>Backtesting & Performance Analytics</h2>

    <div class="back-container">

        <button id="back_refresh" class="btn-primary">Refresh Backtest</button>

        <div class="stats-grid">

            <div class="stat-box">
                <label>Total Trades</label>
                <span id="b_total">0</span>
            </div>

            <div class="stat-box">
                <label>Win Rate %</label>
                <span id="b_winrate">0%</span>
            </div>

            <div class="stat-box">
                <label>Net Profit</label>
                <span id="b_netprofit">0</span>
            </div>

            <div class="stat-box">
                <label>Profit Factor</label>
                <span id="b_pf">0</span>
            </div>

            <div class="stat-box">
                <label>Max Drawdown</label>
                <span id="b_dd">0</span>
            </div>

            <div class="stat-box">
                <label>Avg R:R</label>
                <span id="b_rr">0</span>
            </div>

        </div>

        <h3>Equity Curve</h3>
        <canvas id="equityChart" height="140"></canvas>

        <h3>Pair Performance</h3>
        <div id="pair_stats" class="pair-performance"></div>

    </div>

</div>


</div>

<script>

/* PAGE SWITCHING */
document.querySelectorAll(".nav-btn").forEach(btn=>{
    btn.onclick = ()=>{
        document.querySelectorAll(".nav-btn").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");

        const page = btn.dataset.page;
        document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
        document.getElementById(page).classList.add("active");
    };
});

/* THEME TOGGLE */
document.getElementById("themeToggle").onclick = ()=>{
    document.body.classList.toggle("theme-light");
};

/* LANGUAGE SWITCH (STRUCTURE ONLY) */
let lang = "ar";
document.getElementById("langToggle").onclick = ()=>{
    lang = (lang === "ar") ? "en" : "ar";
    document.getElementById("langToggle").textContent = lang.toUpperCase();
    // سيتم إضافة نظام الترجمة لاحقًا
};

</script>
  <script>

/* --------------------------------------- */
/*         1) TRANSLATION DICTIONARY       */
/* --------------------------------------- */

<script>

const dict = {
  ar: {
    // HEADER
    PositionSizing: "تحديد حجم الصفقة",
    RiskEngine: "محرك إدارة المخاطر",
    TradeLog: "سجل الصفقات",
    Backtesting: "الاختبار الرجعي وتحليل الأداء",

    // COMMON
    Calculate: "احسب",
    AddTrade: "تسجيل صفقة",
    ExportCSV: "تصدير ملف CSV",
    ClearAll: "مسح جميع البيانات",

    // POSITION SIZING
    AccBalance: "رصيد الحساب (USD)",
    RiskPercent: "نسبة المخاطرة لكل صفقة %",
    EntryPrice: "سعر الدخول",
    StopLoss: "وقف الخسارة",
    StopPips: "مسافة الوقف (نقاط)",
    Direction: "نوع العملية",
    Symbol: "زوج/أداة التداول",
    Leverage: "الرافعة المالية",
    Results: "نتائج الحساب",
    LotSize: "حجم اللوت",
    RiskAmount: "قيمة المخاطرة ($)",
    PipDistance: "عدد النقاط",
    Margin: "الهامش المطلوب",
    Notional: "القيمة الإسمية",
    TP1: "الهدف الأول (2× مخاطرة)",
    TP2: "الهدف الثاني (3× مخاطرة)",
    TP3: "الهدف الثالث (4× مخاطرة)",

    // RISK ENGINE
    REngineCalc: "تشغيل محرك المخاطر",
    RewardTP1: "العائد المتوقع (2×)",
    RewardTP2: "العائد المتوقع (3×)",
    RewardTP3: "العائد المتوقع (4×)",
    RR1: "العائد/المخاطرة (2×)",
    RR2: "العائد/المخاطرة (3×)",
    RR3: "العائد/المخاطرة (4×)",

    // TRADE LOG
    Notes: "ملاحظات الصفقة",
    Result: "نتيجة الصفقة",
    Win: "ربح",
    Loss: "خسارة",
    BE: "تعادل",

    // BACKTESTING
    TotalTrades: "إجمالي الصفقات",
    WinRate: "نسبة الفوز",
    NetProfit: "صافي الربح",
    ProfitFactor: "معامل الربحية",
    MaxDrawdown: "أقصى سحب",
    AvgRR: "متوسط العائد/المخاطرة",
    EquityCurve: "منحنى الأداء",
    PairPerformance: "أداء الأزواج"
  },

  en: {
    // HEADER
    PositionSizing: "Position Sizing",
    RiskEngine: "Risk Management Engine",
    TradeLog: "Trade Log",
    Backtesting: "Backtesting & Performance Analytics",

    // COMMON
    Calculate: "Calculate",
    AddTrade: "Add Trade",
    ExportCSV: "Export CSV",
    ClearAll: "Clear All",

    // POSITION SIZING
    AccBalance: "Account Balance (USD)",
    RiskPercent: "Risk % per Trade",
    EntryPrice: "Entry Price",
    StopLoss: "Stop Loss",
    StopPips: "Stop Distance (Pips)",
    Direction: "Trade Direction",
    Symbol: "Symbol",
    Leverage: "Leverage",
    Results: "Calculation Results",
    LotSize: "Lot Size",
    RiskAmount: "Risk Amount ($)",
    PipDistance: "Pip Distance",
    Margin: "Required Margin",
    Notional: "Notional Value",
    TP1: "TP1 (2× Risk)",
    TP2: "TP2 (3× Risk)",
    TP3: "TP3 (4× Risk)",

    // RISK ENGINE
    REngineCalc: "Run Risk Engine",
    RewardTP1: "Expected Reward (2×)",
    RewardTP2: "Expected Reward (3×)",
    RewardTP3: "Expected Reward (4×)",
    RR1: "R:R (2×)",
    RR2: "R:R (3×)",
    RR3: "R:R (4×)",

    // TRADE LOG
    Notes: "Trade Notes",
    Result: "Result",
    Win: "Win",
    Loss: "Loss",
    BE: "Break Even",

    // BACKTESTING
    TotalTrades: "Total Trades",
    WinRate: "Win Rate",
    NetProfit: "Net Profit",
    ProfitFactor: "Profit Factor",
    MaxDrawdown: "Max Drawdown",
    AvgRR: "Average R:R",
    EquityCurve: "Equity Curve",
    PairPerformance: "Pair Performance"
  }
};
function applyTranslation(lang) {

  document.querySelectorAll("[data-i18n]").forEach(el => {
    let key = el.dataset.i18n;
    if (dict[lang][key]) {
      el.textContent = dict[lang][key];
    }
  });

  // RTL / LTR
  if (lang === "ar") {
    document.documentElement.dir = "rtl";
    document.documentElement.lang = "ar";
  } else {
    document.documentElement.dir = "ltr";
    document.documentElement.lang = "en";
  }

  // Save lang
  localStorage.setItem("busultan_lang", lang);
}


// BUTTON
document.getElementById("langToggle").onclick = ()=>{

  const current = localStorage.getItem("busultan_lang") || "ar";
  const next = current === "ar" ? "en" : "ar";

  document.getElementById("langToggle").textContent = next.toUpperCase();

  applyTranslation(next);
};


// INITIAL LOAD
(function(){
  const saved = localStorage.getItem("busultan_lang") || "ar";
  document.getElementById("langToggle").textContent = saved.toUpperCase();
  applyTranslation(saved);
})();


/* --------------------------------------- */
/*      2) APPLY TRANSLATION TO UI         */
/* --------------------------------------- */

function applyTranslation(lang) {

  document.querySelectorAll("[data-i18n]").forEach(el => {
    let key = el.dataset.i18n;
    if (dict[lang][key]) {
      el.textContent = dict[lang][key];
    }
  });

  // Direction switch
  if (lang === "ar") {
    document.documentElement.dir = "rtl";
    document.documentElement.lang = "ar";
  } else {
    document.documentElement.dir = "ltr";
    document.documentElement.lang = "en";
  }

  // Save current language
  localStorage.setItem("busultan_lang", lang);
}


/* --------------------------------------- */
/*       3) LANGUAGE SWITCH BUTTON          */
/* --------------------------------------- */

document.getElementById("langToggle").onclick = () => {

  const current = localStorage.getItem("busultan_lang") || "ar";
  const next = current === "ar" ? "en" : "ar";

  document.getElementById("langToggle").textContent = next.toUpperCase();
  
  applyTranslation(next);
};


/* --------------------------------------- */
/*         4) FIRST LOAD LANGUAGE          */
/* --------------------------------------- */

(function initLanguage(){
  const saved = localStorage.getItem("busultan_lang") || "ar";
  document.getElementById("langToggle").textContent = saved.toUpperCase();
  applyTranslation(saved);
})();
    
</script>

<script>

/* ---------------------------- */
/*   GROUP CONFIG FOR SYMBOLS   */
/* ---------------------------- */

const groupConfig = {
    major:  { pipSize: 0.0001, pipValuePerLot: 10, contractSize: 100000 },
    jpy:    { pipSize: 0.01,   pipValuePerLot: 9.5, contractSize: 100000 },
    cross:  { pipSize: 0.0001, pipValuePerLot: 9,  contractSize: 100000 },
    metals: { pipSize: 0.1,    pipValuePerLot: 10, contractSize: 100 },
    oil:    { pipSize: 0.01,   pipValuePerLot: 10, contractSize: 1000 },
    indices:{ pipSize: 1,      pipValuePerLot: 1,  contractSize: 1 }
};

/* RETURN NUMBER OF DECIMALS BASED ON PIP SIZE */
function getDecimals(pip) {
    let d = 0;
    while (pip < 1) { pip *= 10; d++; }
    return d;
}

/* ---------------------------- */
/*       CALCULATION ENGINE     */
/* ---------------------------- */

document.getElementById("calcBtn").addEventListener("click", ()=>{

    const balance = parseFloat(document.getElementById("balance").value);
    const riskPct = parseFloat(document.getElementById("risk").value);
    const entry   = parseFloat(document.getElementById("entry").value);
    const slInput = document.getElementById("sl").value;
    const stopPips= parseFloat(document.getElementById("stopPips").value);
    const direction = document.getElementById("direction").value;
    const leverage  = parseFloat(document.getElementById("leverage").value);

    const symbolSelect = document.getElementById("symbol");
    const symbol = symbolSelect.value;
    const group = symbolSelect.options[symbolSelect.selectedIndex].dataset.group;

    if (!balance || !riskPct || !entry) {
        alert("Please fill required fields");
        return;
    }

    const cfg = groupConfig[group];

    let sl = parseFloat(slInput);

    /* --- Auto SL from pip distance --- */
    if (isNaN(sl)) {
        if (!stopPips || stopPips <= 0) {
            alert("Enter SL or stop pips");
            return;
        }
        const autoPipsPrice = stopPips * cfg.pipSize;
        if (direction === "buy") sl = entry - autoPipsPrice;
        else sl = entry + autoPipsPrice;
    }

    /* pip distance */
    const pipDistPrice = Math.abs(entry - sl);
    const pipDistance  = pipDistPrice / cfg.pipSize;

    if (pipDistance <= 0) {
        alert("Stop loss distance is zero.");
        return;
    }

    /* risk amount in $ */
    const riskAmount = balance * (riskPct / 100);

    /* lot size */
    const lotSize = riskAmount / (pipDistance * cfg.pipValuePerLot);

    /* notional + margin */
    const notional = lotSize * cfg.contractSize;
    const margin   = notional / leverage;

    /* TP1 / TP2 / TP3 */
    const dec = getDecimals(cfg.pipSize);
    let tp1, tp2, tp3;

    if (direction === "buy") {
        tp1 = entry + (pipDistPrice * 2);
        tp2 = entry + (pipDistPrice * 3);
        tp3 = entry + (pipDistPrice * 4);
    } else {
        tp1 = entry - (pipDistPrice * 2);
        tp2 = entry - (pipDistPrice * 3);
        tp3 = entry - (pipDistPrice * 4);
    }

    /* OUTPUT TO UI */
    document.getElementById("lotSize").textContent = lotSize.toFixed(2);
    document.getElementById("riskAmount").textContent = riskAmount.toFixed(2);
    document.getElementById("pipDistance").textContent = pipDistance.toFixed(1);
    document.getElementById("marginRequired").textContent = margin.toFixed(2);
    document.getElementById("notional").textContent = Math.round(notional);

    document.getElementById("tp1").textContent = tp1.toFixed(dec);
    document.getElementById("tp2").textContent = tp2.toFixed(dec);
    document.getElementById("tp3").textContent = tp3.toFixed(dec);

    document.getElementById("resultsBox").classList.remove("hidden");

});


</script>
<script>

document.getElementById("r_calcBtn").onclick = ()=>{

    const balance   = parseFloat(document.getElementById("r_balance").value);
    const riskPct   = parseFloat(document.getElementById("r_riskPct").value);
    const entry     = parseFloat(document.getElementById("r_entry").value);
    const slInput   = document.getElementById("r_sl").value;
    const stopPips  = parseFloat(document.getElementById("r_stopPips").value);
    const direction = document.getElementById("r_direction").value;

    const symbolSel = document.getElementById("r_symbol");
    const group     = symbolSel.options[symbolSel.selectedIndex].dataset.group;

    const cfg = groupConfig[group];

    let sl = parseFloat(slInput);

    /* auto SL */
    if (isNaN(sl)) {
        if (!stopPips) {
            alert("Enter SL or stop pips");
            return;
        }
        const p = stopPips * cfg.pipSize;
        sl = (direction === "buy") ? (entry - p) : (entry + p);
    }

    const pipDist = Math.abs(entry - sl) / cfg.pipSize;
    const riskAmount = balance * (riskPct/100);
    const lotSize    = riskAmount / (pipDist * cfg.pipValuePerLot);

    const priceRisk = Math.abs(entry - sl);
    const reward1 = priceRisk * 2;
    const reward2 = priceRisk * 3;
    const reward3 = priceRisk * 4;

    const rr1 = 2;
    const rr2 = 3;
    const rr3 = 4;

    /* OUTPUT */
    document.getElementById("r_riskAmount").textContent = riskAmount.toFixed(2);
    document.getElementById("r_pipDistance").textContent= pipDist.toFixed(1);
    document.getElementById("r_lotSize").textContent    = lotSize.toFixed(2);

    document.getElementById("r_reward1").textContent = reward1.toFixed(5);
    document.getElementById("r_reward2").textContent = reward2.toFixed(5);
    document.getElementById("r_reward3").textContent = reward3.toFixed(5);

    document.getElementById("r_rr1").textContent = rr1.toFixed(1);
    document.getElementById("r_rr2").textContent = rr2.toFixed(1);
    document.getElementById("r_rr3").textContent = rr3.toFixed(1);

    document.getElementById("r_results").classList.remove("hidden");

};

</script>
<script>

function loadTrades() {
    const trades = JSON.parse(localStorage.getItem("busultan_trades") || "[]");
    const tbody = document.getElementById("log_body");
    tbody.innerHTML = "";

    trades.forEach((t, i)=>{
        const row = document.createElement("tr");

        if (t.result === "Win")  row.classList.add("win");
        if (t.result === "Loss") row.classList.add("loss");
        if (t.result === "BE")   row.classList.add("be");

        row.innerHTML = `
            <td>${t.symbol}</td>
            <td>${t.dir}</td>
            <td>${t.entry}</td>
            <td>${t.sl}</td>
            <td>${t.tp1}</td>
            <td>${t.tp2}</td>
            <td>${t.tp3}</td>
            <td>${t.result}</td>
            <td>${t.notes}</td>
            <td><button onclick="deleteTrade(${i})">X</button></td>
        `;

        tbody.appendChild(row);
    });
}

function deleteTrade(i) {
    const trades = JSON.parse(localStorage.getItem("busultan_trades") || "[]");
    trades.splice(i,1);
    localStorage.setItem("busultan_trades", JSON.stringify(trades));
    loadTrades();
}

document.getElementById("log_add").onclick = ()=>{

    const trade = {
        symbol: document.getElementById("log_symbol").value,
        dir:    document.getElementById("log_direction").value,
        entry:  document.getElementById("log_entry").value,
        sl:     document.getElementById("log_sl").value,
        tp1:    document.getElementById("log_tp1").value,
        tp2:    document.getElementById("log_tp2").value,
        tp3:    document.getElementById("log_tp3").value,
        result: document.getElementById("log_result").value,
        notes:  document.getElementById("log_notes").value,
    };

    const trades = JSON.parse(localStorage.getItem("busultan_trades") || "[]");
    trades.push(trade);
    localStorage.setItem("busultan_trades", JSON.stringify(trades));

    loadTrades();
};

document.getElementById("log_clear").onclick = ()=>{
    if (confirm("Delete ALL trades?")) {
        localStorage.removeItem("busultan_trades");
        loadTrades();
    }
};

document.getElementById("log_export").onclick = ()=>{
    const trades = JSON.parse(localStorage.getItem("busultan_trades") || "[]");

    let csv = "Symbol,Direction,Entry,SL,TP1,TP2,TP3,Result,Notes\n";
    trades.forEach(t=>{
        csv += `${t.symbol},${t.dir},${t.entry},${t.sl},${t.tp1},${t.tp2},${t.tp3},${t.result},${t.notes}\n`;
    });

    const file = new Blob([csv], {type:"text/csv"});
    const a = document.createElement("a");
    a.href = URL.createObjectURL(file);
    a.download = "trades.csv";
    a.click();
};

loadTrades();

</script>
<script>

function runBacktest() {

    const trades = JSON.parse(localStorage.getItem("busultan_trades") || "[]");

    let wins = 0, losses = 0, be = 0;

    let profit = 0;
    let loss   = 0;

    let rrList = [];

    let equity = 0;
    let curve = [];

    let pairStats = {};

    trades.forEach((t)=>{

        let res = 0;

        if (t.result === "Win") {
            wins++;
            res = Math.abs(t.tp1 - t.entry); 
            profit += res;
            equity += res;
            rrList.push(2); 
        }

        if (t.result === "Loss") {
            losses++;
            res = -Math.abs(t.entry - t.sl);
            loss += Math.abs(res);
            equity += res;
            rrList.push(-1); 
        }

        if (t.result === "BE") {
            be++;
            rrList.push(0);
        }

        curve.push(equity);

        // Pair stats
        if (!pairStats[t.symbol]) {
            pairStats[t.symbol] = { w:0, l:0, be:0 };
        }
        if (t.result === "Win")  pairStats[t.symbol].w++;
        if (t.result === "Loss") pairStats[t.symbol].l++;
        if (t.result === "BE")   pairStats[t.symbol].be++;
    });

    const total = trades.length;
    const winrate = total ? (wins / total * 100).toFixed(1) : 0;

    const netprofit = profit - loss;

    const profitFactor = loss === 0 ? profit : (profit / loss).toFixed(2);

    let maxDD = 0;
    let peak = -999999;

    curve.forEach(e => {
        if (e > peak) peak = e;
        let dd = peak - e;
        if (dd > maxDD) maxDD = dd;
    });

    const rrAvg =
        rrList.length ? (rrList.reduce((a,b)=>a+b,0) / rrList.length).toFixed(2) : 0;

    // OUTPUT
    document.getElementById("b_total").textContent = total;
    document.getElementById("b_winrate").textContent = winrate+"%";
    document.getElementById("b_netprofit").textContent = netprofit.toFixed(2);
    document.getElementById("b_pf").textContent = profitFactor;
    document.getElementById("b_dd").textContent = maxDD.toFixed(2);
    document.getElementById("b_rr").textContent = rrAvg;

    drawEquityCurve(curve);

    let pHTML = "";
    for (let s in pairStats) {
        pHTML += `<div><b>${s}</b>: W:${pairStats[s].w} L:${pairStats[s].l} BE:${pairStats[s].be}</div>`;
    }
    document.getElementById("pair_stats").innerHTML = pHTML;
}

/* -------------------- */
/* Equity curve drawing */
/* -------------------- */

function drawEquityCurve(data) {

    const canvas = document.getElementById("equityChart");
    const ctx = canvas.getContext("2d");

    ctx.clearRect(0,0,canvas.width,canvas.height);

    if (data.length === 0) return;

    const max = Math.max(...data);
    const min = Math.min(...data);

    const scaleX = canvas.width / (data.length - 1);
    const scaleY = canvas.height / (max - min || 1);

    ctx.beginPath();
    ctx.strokeStyle = "#22c55e";
    ctx.lineWidth = 3;

    data.forEach((val, i)=>{
        const x = i * scaleX;
        const y = canvas.height - (val - min) * scaleY;
        if (i===0) ctx.moveTo(x,y);
        else ctx.lineTo(x,y);
    });

    ctx.stroke();
}

/* BUTTON */
document.getElementById("back_refresh").onclick = runBacktes_

</body>
</html>
