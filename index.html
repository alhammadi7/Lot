<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Busultan – حاسبة اللوت المتقدمة</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      min-height: 100vh;
      background:
        radial-gradient(circle at top left, #202847, #050614 55%, #020208);
      color: #f5f7ff;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 32px 10px;
    }

    .shell {
      width: 100%;
      max-width: 980px;
      border-radius: 26px;
      padding: 2px;
      background:
        linear-gradient(135deg, rgba(90, 151, 255, 0.9), rgba(255, 145, 77, 0.9));
      box-shadow: 0 30px 70px rgba(0, 0, 0, 0.85);
    }

    .card {
      width: 100%;
      border-radius: 24px;
      background:
        radial-gradient(circle at top right, #1a1f37, #050613 55%);
      padding: 22px 22px 24px;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
    }

    .brand-wrap {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-candles {
      width: 52px;
      height: 52px;
      border-radius: 20px;
      background:
        radial-gradient(circle at top, #343f6a, #090c21 65%);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.9);
      position: relative;
      overflow: hidden;
    }

    .logo-candle {
      position: absolute;
      bottom: 10px;
      width: 8px;
      border-radius: 999px;
    }

    .logo-candle::before {
      content: "";
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      top: -8px;
      bottom: -8px;
      width: 2px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.9);
    }

    .logo-candle:nth-child(1) {
      left: 11px;
      height: 20px;
      background: #3f8cff;
    }

    .logo-candle:nth-child(2) {
      left: 23px;
      height: 30px;
      background: #ff5c7a;
    }

    .logo-candle:nth-child(3) {
      left: 35px;
      height: 17px;
      background: #35d39b;
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .brand-title {
      font-weight: 700;
      letter-spacing: 0.04em;
      font-size: 18px;
    }

    .brand-sub {
      font-size: 11px;
      opacity: 0.78;
    }

    .badge {
      font-size: 10px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.06);
      margin-right: 4px;
    }

    .lang-toggle {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 11px;
      opacity: 0.86;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .dot {
      width: 9px;
      height: 9px;
      border-radius: 50%;
      background: #ffb341;
      box-shadow: 0 0 10px rgba(255, 179, 65, 0.95);
    }

    .header-tabs {
      display: inline-flex;
      gap: 6px;
      padding: 3px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.25);
      border: 1px solid rgba(255, 255, 255, 0.05);
      margin-top: 6px;
    }

    .header-tab {
      font-size: 10px;
      padding: 4px 9px;
      border-radius: 999px;
      opacity: 0.78;
    }

    .header-tab.active {
      background: linear-gradient(135deg, #3f8cff, #945bff);
      opacity: 1;
    }

    h2 {
      font-size: 18px;
      margin-bottom: 4px;
      text-align: center;
    }

    .subtitle {
      font-size: 11px;
      text-align: center;
      opacity: 0.82;
      margin-bottom: 18px;
    }

    .layout {
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .panel {
      border-radius: 18px;
      background: radial-gradient(circle at top left, #181e35, #050613 60%);
      border: 1px solid rgba(255, 255, 255, 0.07);
      padding: 14px 14px 18px;
    }

    .panel-title {
      font-size: 12px;
      opacity: 0.88;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .panel-title span {
      font-size: 10px;
      opacity: 0.6;
    }

    form {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px 16px;
    }

    @media (max-width: 700px) {
      form {
        grid-template-columns: 1fr;
      }
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 12px;
    }

    label {
      opacity: 0.96;
    }

    .example {
      font-size: 10px;
      opacity: 0.6;
    }

    input,
    select {
      width: 100%;
      border-radius: 11px;
      border: 1px solid rgba(255, 255, 255, 0.14);
      background: rgba(5, 6, 16, 0.9);
      color: #f5f7ff;
      padding: 8px 11px;
      font-size: 13px;
      outline: none;
      transition: border 0.18s ease, box-shadow 0.18s ease,
        background 0.18s ease, transform 0.08s ease;
    }

    input::placeholder {
      color: rgba(255, 255, 255, 0.33);
    }

    input:focus,
    select:focus {
      border-color: #3f8cff;
      box-shadow: 0 0 0 1px rgba(63, 140, 255, 0.55);
      background: rgba(6, 10, 30, 0.96);
      transform: translateY(-0.5px);
    }

    select {
      cursor: pointer;
    }

    .full-row {
      grid-column: 1 / -1;
    }

    .btn-row {
      margin-top: 8px;
      display: flex;
      gap: 10px;
      justify-content: flex-start;
      flex-wrap: wrap;
      grid-column: 1 / -1;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 9px 18px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.02em;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.12s ease, box-shadow 0.12s ease,
        background 0.12s ease, opacity 0.12s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #3f8cff, #945bff);
      color: #ffffff;
      box-shadow: 0 12px 26px rgba(0, 0, 0, 0.9);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 32px rgba(0, 0, 0, 0.95);
    }

    .btn-ghost {
      background: rgba(255, 255, 255, 0.04);
      color: #d3d7ff;
    }

    .btn-ghost:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateY(-1px);
    }

    .results-panel {
      border-radius: 18px;
      background: radial-gradient(circle at top left, #14192b, #050612 60%);
      border: 1px solid rgba(255, 255, 255, 0.07);
      padding: 14px 14px 16px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 10px;
      font-size: 12px;
    }

    @media (max-width: 850px) {
      .results-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 550px) {
      .results-grid {
        grid-template-columns: 1fr;
      }
    }

    .result-box {
      background: radial-gradient(circle at top left, #1c2340, #070818);
      border-radius: 13px;
      padding: 9px 11px;
      border: 1px solid rgba(255, 255, 255, 0.06);
    }

    .result-label {
      font-size: 11px;
      opacity: 0.66;
      margin-bottom: 3px;
    }

    .result-value {
      font-size: 15px;
      font-weight: 600;
    }

    .result-hint {
      font-size: 10px;
      opacity: 0.55;
      margin-top: 3px;
    }

    .warning {
      font-size: 10px;
      color: #ffb341;
      opacity: 0.9;
      margin-top: 2px;
    }

    .pair-tag {
      font-size: 11px;
      opacity: 0.75;
    }

    .pair-tag span {
      opacity: 0.55;
    }
  </style>
</head>
<body>
  <div class="shell">
    <div class="card">
      <div class="card-header">
        <div>
          <div class="brand-wrap">
            <div class="logo-candles">
              <div class="logo-candle"></div>
              <div class="logo-candle"></div>
              <div class="logo-candle"></div>
            </div>
            <div class="brand">
              <div class="brand-title">Busultan Trading</div>
              <div class="brand-sub">
                إدارة مخاطر احترافية
                <span class="badge">MULTI-ASSET • FUNDING • R:R</span>
              </div>
            </div>
          </div>
          <div class="header-tabs">
            <div class="header-tab active">Position Sizing</div>
            <div class="header-tab">Risk Engine</div>
          </div>
        </div>

        <div class="lang-toggle">
          AR
          <span class="dot"></span>
        </div>
      </div>

      <h2>حاسبة اللوت المتقدمة</h2>
      <div class="subtitle">
        حدد رصيد الحساب، نسبة المخاطرة، وسعر الدخول/الوقف والأداة – وسيتم حساب حجم اللوت،
        قيمة المخاطرة والهامش المطلوب والأهداف تلقائيًا.
      </div>

      <div class="layout">
        <!-- FORM -->
        <div class="panel">
          <div class="panel-title">
            إعدادات الصفقة
            <span>Step 1 – Inputs</span>
          </div>
          <form id="lotForm">
            <div class="field">
              <label for="balance">رصيد الحساب (USD)</label>
              <span class="example">مثال: 10000</span>
              <input id="balance" type="number" step="0.01" placeholder="10000" required />
            </div>

            <div class="field">
              <label for="risk">نسبة المخاطرة من الحساب %</label>
              <span class="example">1 = مخاطرة 1% من رصيد الحساب</span>
              <input id="risk" type="number" step="0.01" placeholder="1" required />
            </div>

            <div class="field">
              <label for="entry">سعر الدخول (Entry)</label>
              <span class="example">مثال EURUSD: 1.08500 – USDJPY: 156.30</span>
              <input id="entry" type="number" step="0.00001" placeholder="1.08500" required />
            </div>

            <div class="field">
              <label for="sl">سعر وقف الخسارة (SL)</label>
              <span class="example">يمكن تركه فارغ ليتم حسابه من مسافة الوقف</span>
              <input id="sl" type="number" step="0.00001" placeholder="153.999" />
            </div>

            <div class="field full-row">
              <label for="symbol">زوج / أداة التداول</label>
              <span class="example">أزواج رئيسية، أزواج ين، كروس، ذهب/فضة، نفط، مؤشرات</span>
              <select id="symbol">
                <!-- COMMODITIES / FUTURES -->
                <option value="XAUUSD" data-group="metals">XAUUSD – Gold (ذهب)</option>
                <option value="XAGUSD" data-group="metals">XAGUSD – Silver (فضة)</option>
                <option value="WTI" data-group="oil">WTI – Crude Oil</option>
                <option value="US100" data-group="indices">US100 – Nasdaq</option>

                <!-- MAJOR FOREX -->
                <option value="EURUSD" data-group="major">EURUSD – Major</option>
                <option value="USDJPY" data-group="jpy">USDJPY – JPY Pair</option>
                <option value="AUDUSD" data-group="major">AUDUSD – Major</option>
                <option value="NZDUSD" data-group="major">NZDUSD – Major</option>
                <option value="USDCHF" data-group="major">USDCHF – Major</option>
                <option value="USDCAD" data-group="major">USDCAD – Major</option>

                <!-- JPY CROSSES -->
                <option value="GBPJPY" data-group="jpy">GBPJPY – JPY Cross</option>
                <option value="AUDJPY" data-group="jpy">AUDJPY – JPY Cross</option>
                <option value="EURJPY" data-group="jpy">EURJPY – JPY Cross</option>

                <!-- CROSSES -->
                <option value="EURCAD" data-group="cross">EURCAD – Cross</option>
                <option value="AUDCAD" data-group="cross">AUDCAD – Cross</option>
                <option value="EURAUD" data-group="cross">EURAUD – Cross</option>
              </select>
            </div>

            <div class="field">
              <label for="direction">نوع الصفقة</label>
              <span class="example">مهم لحساب الأهداف ووقف الخسارة تلقائيًا</span>
              <select id="direction">
                <option value="buy">شراء (Buy)</option>
                <option value="sell">بيع (Sell)</option>
              </select>
            </div>

            <div class="field">
              <label for="stopPips">مسافة الوقف (بالنقاط)</label>
              <span class="example">إذا كان حقل SL فارغًا سيُحسب من هذه المسافة</span>
              <input id="stopPips" type="number" step="0.1" placeholder="20" />
            </div>

            <div class="field">
              <label for="tp1">هدف 1 (TP1)</label>
              <span class="example">يُحسب تلقائيًا = ضعفين الخسارة</span>
              <input id="tp1" type="number" step="0.00001" placeholder="—" />
            </div>

            <div class="field">
              <label for="tp2">هدف 2 (TP2)</label>
              <span class="example">3 أضعاف الخسارة</span>
              <input id="tp2" type="number" step="0.00001" placeholder="—" />
            </div>

            <div class="field">
              <label for="tp3">هدف 3 (TP3)</label>
              <span class="example">4 أضعاف الخسارة</span>
              <input id="tp3" type="number" step="0.00001" placeholder="—" />
            </div>

            <div class="field">
              <label for="leverage">الرافعة المالية (Leverage)</label>
              <span class="example">مثال: 100 أو 500</span>
              <input id="leverage" type="number" step="1" placeholder="500" value="500" />
            </div>

            <div class="btn-row">
              <button type="submit" class="btn-primary">
                احسب حجم اللوت
              </button>
              <button type="button" id="resetBtn" class="btn-ghost">
                مسح الحقول
              </button>
            </div>
          </form>
        </div>

        <!-- RESULTS UNDER FORM -->
        <div class="results-panel">
          <div class="panel-title">
            مخرجات الحاسبة
            <span>Step 2 – Outputs</span>
          </div>
          <div id="results" style="display:none;">
            <div class="pair-tag">
              الأداة الحالية:
              <span id="currentSymbol">—</span>
            </div>

            <div class="results-grid">
              <div class="result-box">
                <div class="result-label">حجم اللوت المقترح</div>
                <div class="result-value" id="lotSize">0.00</div>
                <div class="result-hint">لوت قياسي/مصغر حسب نوع الأداة</div>
              </div>

              <div class="result-box">
                <div class="result-label">المبلغ المعرض للمخاطرة (USD)</div>
                <div class="result-value" id="riskAmount">0.00</div>
                <div class="result-hint">الخسارة المتوقعة عند ضرب وقف الخسارة</div>
              </div>

              <div class="result-box">
                <div class="result-label">عدد النقاط حتى وقف الخسارة</div>
                <div class="result-value" id="pipDistance">0.0</div>
                <div class="result-hint">محسوبة حسب قيمة النقطة للأداة</div>
              </div>

              <div class="result-box">
                <div class="result-label">الهامش المستخدم تقريبًا</div>
                <div class="result-value" id="marginRequired">0.00</div>
                <div class="result-hint">بالدولار باستخدام الرافعة المحددة (Notional / Leverage)</div>
              </div>

              <div class="result-box">
                <div class="result-label">حجم العقد الاسمي (Notional)</div>
                <div class="result-value" id="notional">0</div>
                <div class="result-hint">وحدات تقريبية للعقد (Contract Size)</div>
              </div>

              <div class="result-box">
                <div class="result-label">نسبة المخاطرة الفعلية من الرصيد</div>
                <div class="result-value" id="riskPctReal">0.00%</div>
                <div class="result-hint">للتأكد أن الحساب مطابق لنسبة المخاطرة المدخلة</div>
              </div>
            </div>

            <div class="warning">
              ملاحظة مهمة: الحاسبة تقريبية تعليمية. القيم الفعلية تختلف حسب شركة الوساطة،
              نوع الحساب، السبريد والعمولات، وقيمة النقطة لكل أداة.  
              طبيعي في إدارة المخاطر أن يتناقص الهامش عندما توسّع وقف الخسارة لأن حجم اللوت
              يقل للحفاظ على نفس نسبة المخاطرة من الرصيد.
            </div>
          </div>

          <div id="noResults" style="font-size:12px; opacity:0.7; margin-top:8px;">
            أدخل بيانات الصفقة واضغط "احسب حجم اللوت" لعرض النتائج والأهداف.
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const groupConfig = {
      major: {
        pipSize: 0.0001,
        pipValuePerLot: 10,
        contractSize: 100000
      },
      jpy: {
        pipSize: 0.01,
        pipValuePerLot: 9.5,
        contractSize: 100000
      },
      cross: {
        pipSize: 0.0001,
        pipValuePerLot: 9,
        contractSize: 100000
      },
      metals: {
        pipSize: 0.1,
        pipValuePerLot: 10,
        contractSize: 100
      },
      oil: {
        pipSize: 0.01,
        pipValuePerLot: 10,
        contractSize: 1000
      },
      indices: {
        pipSize: 1,
        pipValuePerLot: 1,
        contractSize: 1
      }
    };

    function decimalsFromPip(pipSize) {
      let d = 0;
      let v = pipSize;
      while (v < 1 && d < 8) {
        v *= 10;
        d++;
      }
      return d;
    }

    const form = document.getElementById("lotForm");
    const resultsWrapper = document.getElementById("results");
    const noResults = document.getElementById("noResults");

    form.addEventListener("submit", function (e) {
      e.preventDefault();

      const balance = parseFloat(document.getElementById("balance").value);
      const riskPercentInput = parseFloat(document.getElementById("risk").value);
      const entry = parseFloat(document.getElementById("entry").value);
      const leverage = parseFloat(document.getElementById("leverage").value || 1);

      const symbolSelect = document.getElementById("symbol");
      const symbol = symbolSelect.value;
      const groupKey =
        symbolSelect.options[symbolSelect.selectedIndex].dataset.group || "major";

      const direction = document.getElementById("direction").value;
      const stopPips = parseFloat(document.getElementById("stopPips").value);
      const slInput = document.getElementById("sl");

      if (
        !isFinite(balance) ||
        !isFinite(riskPercentInput) ||
        !isFinite(entry) ||
        balance <= 0 ||
        riskPercentInput <= 0
      ) {
        alert("رجاءً تأكد من إدخال بيانات صحيحة في الحقول الأساسية.");
        return;
      }

      const config = groupConfig[groupKey];
      if (!config) {
        alert("لا يوجد إعدادات لهذه الأداة، تواصل مع المطور لإضافتها.");
        return;
      }

      let sl = parseFloat(slInput.value);

      if (!isFinite(sl)) {
        if (!isFinite(stopPips) || stopPips <= 0) {
          alert("إما أدخل وقف الخسارة يدويًا أو حدد مسافة الوقف بالنقاط للحساب التلقائي.");
          return;
        }
        const priceDistanceAuto = stopPips * config.pipSize;
        if (direction === "buy") {
          sl = entry - priceDistanceAuto;
        } else {
          sl = entry + priceDistanceAuto;
        }
        const dec = decimalsFromPip(config.pipSize);
        slInput.value = sl.toFixed(dec);
      }

      const pipDistanceRaw = Math.abs(entry - sl);
      const pipDistance = pipDistanceRaw / config.pipSize;

      if (!isFinite(pipDistance) || pipDistance === 0) {
        alert("مسافة وقف الخسارة صفر تقريبًا، عدّل سعر الدخول أو وقف الخسارة.");
        return;
      }

      const riskAmount = balance * (riskPercentInput / 100);
      const lotSize = riskAmount / (pipDistance * config.pipValuePerLot);

      const notional = lotSize * config.contractSize;
      const marginRequired = leverage > 0 ? notional / leverage : 0;
      const riskPctReal = (riskAmount / balance) * 100;

      // حساب الأهداف تلقائيًا: 2x, 3x, 4x مسافة الخسارة
      const priceRisk = Math.abs(entry - sl);
      const dec = decimalsFromPip(config.pipSize);
      let tp1, tp2, tp3;
      if (direction === "buy") {
        tp1 = entry + 2 * priceRisk;
        tp2 = entry + 3 * priceRisk;
        tp3 = entry + 4 * priceRisk;
      } else {
        tp1 = entry - 2 * priceRisk;
        tp2 = entry - 3 * priceRisk;
        tp3 = entry - 4 * priceRisk;
      }
      document.getElementById("tp1").value = tp1.toFixed(dec);
      document.getElementById("tp2").value = tp2.toFixed(dec);
      document.getElementById("tp3").value = tp3.toFixed(dec);

      document.getElementById("lotSize").textContent = lotSize.toFixed(2);
      document.getElementById("riskAmount").textContent = riskAmount.toFixed(2);
      document.getElementById("pipDistance").textContent = pipDistance.toFixed(1);
      document.getElementById("marginRequired").textContent =
        marginRequired.toFixed(2);
      document.getElementById("notional").textContent =
        Math.round(notional).toLocaleString("en-US");
      document.getElementById("riskPctReal").textContent =
        riskPctReal.toFixed(2) + "%";
      document.getElementById("currentSymbol").textContent = symbol;

      resultsWrapper.style.display = "block";
      noResults.style.display = "none";
    });

    document.getElementById("resetBtn").addEventListener("click", function () {
      form.reset();
      resultsWrapper.style.display = "none";
      noResults.style.display = "block";
      document.getElementById("currentSymbol").textContent = "—";
    });
  </script>
</body>
</html>
